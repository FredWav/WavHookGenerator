<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="color-scheme" content="dark light"/>
<title>Générateur de Hooks – PRO++</title>
<style>
  :root{
    /* Light (par défaut) */
    --bg:#F7F3EE; --card:#FFFFFF; --ink:#111827; --muted:#6B7280; --border:#E5E7EB;
    --blue:#61A8FF; --blue-strong:#3E8FFF; --shadow:0 10px 30px rgba(0,0,0,.08);
    --good:#16a34a; --mid:#f59e0b; --bad:#ef4444; --radius:18px;
    --panel-grad: none;
  }
  [data-theme="dark"]{
    --bg: radial-gradient(1200px 600px at 20% -10%, #1b2a3a 0%, #0c1722 45%, #0a121a 100%);
    --card: linear-gradient(180deg, #13202d 0%, #0f1a26 100%);
    --ink:#e9eef6; --muted:#9aa6b2; --border:#1f2b3a;
    --blue:#60a5fa; --blue-strong:#3b82f6; --shadow:0 12px 40px rgba(0,0,0,.35);
    --panel-grad: linear-gradient(90deg, transparent, rgba(96,165,250,.35), rgba(255,79,163,.25), transparent);
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial}
  header{max-width:1100px;margin:20px auto 8px;padding:0 16px;display:flex;align-items:center;justify-content:space-between}
  h1{margin:0;font-size:clamp(20px,2.4vw,30px)}
  nav{display:flex;gap:10px;align-items:center}
  nav a{color:var(--ink);text-decoration:none;border:1px solid var(--border);padding:8px 12px;border-radius:999px;background:var(--card)}
  .wrap{max-width:1100px;margin:0 auto 40px;padding:0 16px;display:grid;gap:16px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);position:relative;overflow:hidden}
  .card::before{content:"";position:absolute;left:-2px;right:-2px;top:-2px;height:2px;background:var(--panel-grad)}
  .inner{padding:18px}
  .grid{display:grid;gap:12px}
  @media(min-width:900px){.grid.cols-2{grid-template-columns:1fr 1fr} .grid.cols-3{grid-template-columns:1fr 1fr 1fr}}
  label{font-weight:600;display:block;margin-bottom:6px}
  input[type="text"],textarea,select,input[type="url"]{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:transparent;color:var(--ink)}
  textarea{min-height:70px;resize:vertical}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .btn{border:0;padding:12px 14px;border-radius:14px;background:var(--blue);color:#fff;font-weight:700;cursor:pointer;box-shadow:var(--shadow);transition:background .2s, transform .04s}
  .btn:hover{background:var(--blue-strong)} .btn:active{transform:translateY(1px)}
  .btn.secondary{background:transparent;color:var(--ink);border:1px solid var(--border)}
  .list{display:grid;gap:10px}
  .hook{padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:transparent;display:grid;gap:8px}
  .hook-top{display:flex;gap:10px;align-items:start;justify-content:space-between}
  .hook span.text{flex:1}
  .score{display:flex;align-items:center;gap:10px}
  .score .bar{position:relative;width:180px;height:10px;background:rgba(0,0,0,.08);border-radius:999px;overflow:hidden;border:1px solid var(--border)}
  [data-theme="dark"] .score .bar{background:linear-gradient(90deg,#2a3746,#223040)}
  .score .bar i{position:absolute;left:0;top:0;bottom:0;width:0%}
  .score .grade{font-weight:800;min-width:28px;text-align:center}
  .score.good i{background:var(--good)} .score.mid i{background:var(--mid)} .score.bad i{background:var(--bad)}
  .fav{border:1px solid var(--border);background:transparent;border-radius:999px;padding:6px 10px;cursor:pointer;color:var(--ink)}
  .note{font-size:12px;color:var(--muted)}
  .tip{margin-top:6px;padding:10px 12px;border-left:4px solid var(--blue);background:rgba(96,165,250,.08);border-radius:10px}
</style>
</head>
<body>
  <header>
    <h1>Générateur de hooks</h1>
    <nav>
      <label for="themeSelect" class="note">Thème</label>
      <select id="themeSelect">
        <option value="auto" selected>Auto</option>
        <option value="light">Clair</option>
        <option value="dark">Sombre</option>
      </select>
      <a href="history.html">Historique & Favoris</a>
    </nav>
  </header>

  <section class="wrap">
    <div class="card"><div class="inner">
      <div class="grid cols-3">
        <div>
          <label for="platform">Plateforme</label>
          <select id="platform">
            <option value="tiktok" selected>TikTok</option>
            <option value="reels">Instagram Reels</option>
            <option value="shorts">YouTube Shorts</option>
          </select>
        </div>
        <div>
          <label for="niche">Niche (obligatoire)</label>
          <input id="niche" type="text" placeholder="ex : parodie musicale / montage vidéo / fitness"/>
        </div>
        <div>
          <label for="theme">Thème de la vidéo (obligatoire)</label>
          <input id="theme" type="text" placeholder="ex : parodie Obispo / perte de poids 5kg / automatiser Notion"/>
        </div>
      </div>

      <div class="grid cols-3" style="margin-top:8px">
        <div>
          <label for="tone">Ton</label>
          <select id="tone">
            <option value="intrigant">Intrigant</option>
            <option value="bienveillant">Bienveillant</option>
            <option value="cash">Cash</option>
            <option value="humour" selected>Humour</option>
            <option value="urgent">Urgent</option>
            <option value="educatif">Éducatif</option>
          </select>
        </div>
        <div>
          <label for="audience">Cible (optionnel)</label>
          <input id="audience" type="text" placeholder="ex : débutants, freelances…"/>
        </div>
        <div>
          <label for="count">Nombre</label>
          <select id="count"><option>5</option><option>10</option><option>15</option><option>20</option><option>25</option></select>
        </div>
      </div>

      <div style="margin-top:8px">
        <label for="brief">Brief libre (optionnel)</label>
        <textarea id="brief" placeholder="Contexte, contrainte de style, référence précise…"></textarea>
      </div>

      <div class="grid cols-2" style="margin-top:8px">
        <div>
          <label>Intensité émotionnelle</label>
          <div class="row">
            <span class="note">Léger</span>
            <input id="intensity" type="range" min="1" max="3" step="1" value="2"/>
            <span class="note">Agressif</span>
          </div>
        </div>
        <div>
          <label>Catégories prioritaires (multi‑choix)</label>
          <div class="row" id="catChips">
            <label><input type="checkbox" value="question"/> Question</label>
            <label><input type="checkbox" value="negatif"/> Négatif</label>
            <label><input type="checkbox" value="controverse"/> Controversé</label>
            <label><input type="checkbox" value="promesse"/> Promesse</label>
            <label><input type="checkbox" value="chiffres"/> Chiffres</label>
            <label><input type="checkbox" value="experience"/> Expérience</label>
            <label><input type="checkbox" value="surprenant"/> Surprenant</label>
            <label><input type="checkbox" value="suspense"/> Suspense</label>
            <label><input type="checkbox" value="fomo"/> FOMO</label>
          </div>
        </div>
      </div>

      <div class="grid cols-2" style="margin-top:8px">
        <div>
          <label for="videoLink">Lien de la vidéo (optionnel)</label>
          <input id="videoLink" type="url" placeholder="https://..."/>
        </div>
        <div>
          <label for="videoTitle">Titre / repère (optionnel)</label>
          <input id="videoTitle" type="text" placeholder="ex : Parodie Obispo – Savoir Emmerder"/>
        </div>
      </div>

      <div class="row" style="margin-top:12px">
        <button id="boost" class="btn">Générer (Boost AI)</button>
        <button id="copyAll" class="btn secondary">Tout copier</button>
      </div>
      <p class="tip">Astuce : sois précis dans “Niche” et “Thème”. Sélectionne la plateforme pour un style adapté.</p>
    </div></div>

    <div class="card"><div class="inner">
      <h3 style="margin:0 0 6px">Hooks (avec score)</h3>
      <div id="list" class="list"></div>
    </div></div>
  </section>

<script>
  // ----- Thème Auto / Clair / Sombre -----
  const THEME_KEY='ui_theme_pref';
  const themeSel=document.getElementById('themeSelect');
  const mediaDark=window.matchMedia('(prefers-color-scheme: dark)');
  function applyTheme(pref){
    if(pref==='light'){ document.documentElement.setAttribute('data-theme','light'); return; }
    if(pref==='dark'){  document.documentElement.setAttribute('data-theme','dark');  return; }
    document.documentElement.setAttribute('data-theme', mediaDark.matches ? 'dark' : 'light');
  }
  function getPref(){ return localStorage.getItem(THEME_KEY) || 'auto'; }
  function setPref(v){ localStorage.setItem(THEME_KEY, v); }
  themeSel.value=getPref(); applyTheme(themeSel.value);
  themeSel.onchange=()=>{ setPref(themeSel.value); applyTheme(themeSel.value); };
  mediaDark.addEventListener?.('change', ()=>{ if(getPref()==='auto') applyTheme('auto'); });

  // ----- App -----
  const $ = id => document.getElementById(id);
  const KEY = 'hgpp_history_v1';

  function scoreHook(h, niche, theme){
    let s=0; const words=h.trim().split(/\s+/).length;
    if (words<=12) s+=20;
    if (/^\d/.test(h) || /^[A-ZÉÈÀÂÔÎÛÄËÏÖÜÇ]{2,}/.test(h)) s+=15;
    if (/[!?]/.test(h)) s+=10;
    if (niche && h.toLowerCase().includes(niche.toLowerCase())) s+=15;
    if (theme && h.toLowerCase().includes(theme.toLowerCase())) s+=15;
    if (/ne scrolle pas|arrête|stop|fomo|dernier|ultime|maintenant/i.test(h)) s+=10;
    if (/pourquoi|comment|tu savais|personne|devine/i.test(h)) s+=7;
    if (/pas|erreur|pire|interdit|illégal/i.test(h)) s+=6;
    if (words>12) s-=(words-12)*2;
    return Math.max(0,Math.min(100,s));
  }
  function gradeFromScore(s){ if(s>=90)return"A+"; if(s>=85)return"A"; if(s>=80)return"A-"; if(s>=70)return"B"; if(s>=60)return"C"; if(s>=50)return"D"; return"F"; }
  function barClass(s){ return s>=70?"good":(s>=40?"mid":"bad"); }

  function getIntensity(){ const v=$('intensity').value; return v==="1"?"leger":(v==="3"?"agressif":"normal"); }
  function getCategories(){ return [...document.querySelectorAll('#catChips input:checked')].map(i=>i.value); }
  function payload(){
    return {
      platform:$('platform').value, niche:$('niche').value.trim(), theme:$('theme').value.trim(),
      tone:$('tone').value, audience:$('audience').value.trim(), brief:$('brief').value.trim(),
      intensity:getIntensity(), priorityCategories:getCategories(),
      count: parseInt($('count').value,10)||10
    };
  }

  function loadHistory(){ try{return JSON.parse(localStorage.getItem(KEY)||'[]');}catch{return[];} }
  function saveHistory(l){ try{localStorage.setItem(KEY,JSON.stringify(l));}catch{} }
  function addHistory(e){ const l=loadHistory(); l.unshift(e); if(l.length>200) l.pop(); saveHistory(l); }

  function toggleFav(saveId, hookIndex){
    const list=loadHistory(); const it=list.find(x=>x.id===saveId); if(!it) return;
    it.hooks[hookIndex].fav=!it.hooks[hookIndex].fav; saveHistory(list);
    const btns=document.querySelectorAll('.hook .fav');
    if(btns[hookIndex]) btns[hookIndex].textContent = it.hooks[hookIndex].fav ? '★ Favori':'☆ Favori';
  }

  function renderHooks(hooks, ctx){
    const box=$('list'); box.innerHTML='';
    hooks.forEach((h,idx)=>{
      const s=scoreHook(h, ctx.niche, ctx.theme);
      const g=gradeFromScore(s);
      const row=document.createElement('div'); row.className='hook';
      const top=document.createElement('div'); top.className='hook-top';
      const text=document.createElement('span'); text.className='text'; text.textContent=h;
      const fav=document.createElement('button'); fav.className='fav'; fav.textContent='☆ Favori';
      fav.onclick=()=>toggleFav(ctx._saveId, idx);
      top.appendChild(text); top.appendChild(fav);

      const sc=document.createElement('div'); sc.className='score '+barClass(s);
      const grade=document.createElement('div'); grade.className='grade'; grade.textContent=g;
      const bar=document.createElement('div'); bar.className='bar';
      const fill=document.createElement('i'); fill.style.width=s+'%'; bar.appendChild(fill);
      const note=document.createElement('div'); note.className='note'; note.textContent=s+'/100';
      sc.appendChild(grade); sc.appendChild(bar); sc.appendChild(note);

      row.appendChild(top); row.appendChild(sc);
      box.appendChild(row);
    });
  }

  function saveSession(ctx, hooks){
    const enriched=hooks.map(t=>{ const s=scoreHook(t, ctx.niche, ctx.theme); return {text:t, score:s, grade:gradeFromScore(s), fav:false}; });
    const id=(Date.now().toString(36)+Math.random().toString(36).slice(2,7)).toUpperCase();
    addHistory({
      id, ts:new Date().toISOString(),
      platform:ctx.platform, niche:ctx.niche, theme:ctx.theme, tone:ctx.tone, audience:ctx.audience, brief:ctx.brief,
      intensity:ctx.intensity, categories:ctx.priorityCategories, count:enriched.length,
      video:{ title: $('videoTitle').value.trim(), link: $('videoLink').value.trim() },
      hooks: enriched
    });
    return id;
  }

  async function generate(){
    const p=payload();
    if(!p.niche || !p.theme){ alert('Niche + Thème requis'); return; }
    const r=await fetch('/api/generate-hooks',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(p)});
    if(!r.ok){ alert('Erreur API: '+await r.text()); return; }
    const {hooks=[]}=await r.json();
    const id=saveSession(p, hooks);
    renderHooks(hooks, {...p, _saveId:id});
  }

  document.getElementById('boost').onclick=generate;
  document.getElementById('copyAll').onclick=async()=>{ const all=[...document.querySelectorAll('.hook .text')].map(n=>n.textContent).join('\n'); try{ await navigator.clipboard.writeText(all);}catch{} };

  // Autofill from history resume
  try{
    const resume=JSON.parse(localStorage.getItem('hgpp_resume')||'null');
    if(resume){
      ['platform','niche','theme','tone','audience','brief','count'].forEach(k=>{ const el=$(k); if(el) el.value = (resume[k] ?? el.value); });
      (resume.categories||[]).forEach(v=>{const el=document.querySelector(`#catChips input[value="${v}"]`); if(el) el.checked=true;});
      $('intensity').value = resume.intensity==='leger'?1 : resume.intensity==='agressif'?3 : 2;
      localStorage.removeItem('hgpp_resume');
    }
  }catch{}
</script>
</body>
</html>
