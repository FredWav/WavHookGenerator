<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Générateur de Hooks – Boost AI</title>
  <style>
    :root{ --cream:#F7F3EE; --card:#FFFFFF; --ink:#111827; --muted:#6B7280;
      --blue:#61A8FF; --blue-strong:#3E8FFF; --border:#E5E7EB; --shadow:0 10px 30px rgba(0,0,0,.08); --radius:18px; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--cream);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial}
    header{max-width:980px;margin:24px auto 12px;padding:0 16px}
    h1{margin:0 0 6px;font-size:clamp(22px,2.6vw,34px)}
    .sub{color:var(--muted)}
    .wrap{max-width:980px;margin:0 auto 40px;padding:0 16px;display:grid;gap:16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
    .inner{padding:18px}
    .grid{display:grid;gap:12px}
    @media(min-width:720px){.grid.cols-2{grid-template-columns:1fr 1fr} .grid.cols-3{grid-template-columns:1fr 1fr 1fr}}
    label{font-weight:600;display:block;margin-bottom:6px}
    input[type="text"],select{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#FAFAFA}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{border:0;padding:12px 14px;border-radius:14px;background:var(--blue);color:#fff;font-weight:700;cursor:pointer;box-shadow:var(--shadow);transition:background .2s, transform .04s}
    .btn:hover{background:var(--blue-strong)} .btn:active{transform:translateY(1px)}
    .btn.secondary{background:#fff;color:#111;border:1px solid var(--border)}
    .list{display:grid;gap:10px}
    .hook{padding:10px 12px;border:1px dashed var(--border);border-radius:12px;background:#FCFCFD;display:flex;gap:10px;align-items:start}
    .hook span{flex:1}
    .hook .copy{white-space:nowrap}
    .tip{margin-top:6px;padding:10px 12px;border-left:4px solid var(--blue);background:#F8FAFF;border-radius:10px}
    .small{font-size:12.5px}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#111;color:#fff;padding:10px 14px;border-radius:999px;display:none}
  </style>
</head>
<body>
  <header>
    <h1>Générateur de hooks</h1>
    <div class="sub">Renseigne <b>niche</b>, <b>thème</b>, <b>ton</b>. <span class="muted">La cible est optionnelle.</span></div>
  </header>

  <section class="wrap">
    <div class="card">
      <div class="inner">
        <div class="grid cols-2">
          <div>
            <label for="niche">Niche (obligatoire)</label>
            <input id="niche" type="text" placeholder="ex : formation en ligne / montage vidéo / fitness"/>
          </div>
          <div>
            <label for="theme">Thème de la vidéo (obligatoire)</label>
            <input id="theme" type="text" placeholder="ex : comment monter plus vite / perdre 5kg / automatiser Notion"/>
          </div>
        </div>
        <div class="grid cols-3" style="margin-top:8px">
          <div>
            <label for="tone">Ton</label>
            <select id="tone">
              <option value="intrigant">Intrigant</option>
              <option value="bienveillant">Bienveillant</option>
              <option value="cash">Cash</option>
              <option value="humour">Humour</option>
              <option value="urgent">Urgent</option>
              <option value="educatif">Éducatif</option>
            </select>
          </div>
          <div>
            <label for="audience">Cible (optionnel)</label>
            <input id="audience" type="text" placeholder="ex : débutants, freelances, mamans pressées"/>
          </div>
          <div>
            <label for="count">Nombre</label>
            <select id="count">
              <option>5</option>
              <option selected>10</option>
              <option>15</option>
            </select>
          </div>
        </div>
        <div class="row" style="margin-top:12px">
          <button id="boost" class="btn">Boost AI</button>
          <button id="offline" class="btn secondary">Offline (amélioré)</button>
          <button id="copyAll" class="btn secondary">Tout copier</button>
        </div>
        <p class="tip small">Conseil : commence par un verbe/numéro, promets un bénéfice clair, pas de blabla. Offline est un fallback amélioré; privilégie Boost AI.</p>
      </div>
    </div>

    <div class="card">
      <div class="inner">
        <h3 style="margin:0 0 6px">Hooks</h3>
        <div id="list" class="list"></div>
      </div>
    </div>
  </section>

  <div id="toast" class="toast"></div>

  <script>
    const $ = (id) => document.getElementById(id);
    function toast(msg){ const t=$('toast'); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',1500); }
    const uniq = (arr) => [...new Set(arr.map(s=>s.trim()))];

    // OFFLINE amélioré (templates + scoring)
    const TEMPLATES = [
      "Et si tu {action} pour {benefice} ?",
      "{nombre} erreurs qui ruinent {objectif} — corrige-les aujourd’hui",
      "Tu veux {benefice} sans {obstacle} ? Fais {action}",
      "{nombre} minutes pour {benefice} — {preuve}",
      "{pourcentage}% de {resultat} avec {methode} (testé)",
      "Arrête {mauvaise_pratique} : fais ça et {benefice}",
      "Tout le monde fait {mauvaise_pratique}. Voilà mieux : {methode}",
      "Comment {action} pour {benefice} en {delai}",
      "Avant/après : de {situation_avant} à {benefice} en {delai}",
      "Hier, {situation_avant}. Aujourd’hui, {benefice}. Voilà comment."
    ];

    const BANK = {
      action: ["changer ton intro","poser un chiffre avant tout","montrer le résultat d’entrée","utiliser le cadre 3–30–3","poser une question choc"],
      benefice: ["doubler ton watchtime","x2 tes vues","lancer ton offre","vendre sans forcer","gagner 1h/jour"],
      obstacle: ["pub","budget","logiciel pro","monter 2h","danser","montrer ton visage"],
      objectif: ["tes Reels","tes TikToks","tes Shorts","ton montage","tes ventes"],
      preuve: ["preuve en 3 clips","cas réel","stat vraie","avant/après","screens"],
      pourcentage: ["30","50","80","120"],
      resultat: ["vues","watchtime","clicks","ventes"],
      methode: ["ce template 7 mots","ce cadre en 3 étapes","la checklist 3‑30‑3","preuve->méthode->CTA"],
      mauvaise_pratique: ["raconter avant d’accrocher","parler de toi trop tôt","6 hashtags fourre‑tout","question molle"],
      delai: ["24h","7 jours","30 minutes","3 vidéos","3 étapes"],
      situation_avant: ["0 idées","scroll infini","intro molle","hook plat"],
      nombre: ["3","5","7","10"]
    };
    const START_VERBS = ["STOP","COMMENT","ARRÊTE","ET SI","AVANT/APRÈS","VOILÀ","TU VEUX","HIER"];

    function fillTemplate(niche, theme, tone, audience){
      const pick = (k)=> BANK[k][Math.floor(Math.random()*BANK[k].length)];
      let out = TEMPLATES[Math.floor(Math.random()*TEMPLATES.length)]
        .replace("{action}", pick("action"))
        .replace("{benefice}", pick("benefice"))
        .replace("{obstacle}", pick("obstacle"))
        .replace("{objectif}", theme || niche || pick("objectif"))
        .replace("{preuve}", pick("preuve"))
        .replace("{pourcentage}", pick("pourcentage"))
        .replace("{resultat}", pick("resultat"))
        .replace("{methode}", pick("methode"))
        .replace("{mauvaise_pratique}", pick("mauvaise_pratique"))
        .replace("{delai}", pick("delai"))
        .replace("{situation_avant}", pick("situation_avant"))
        .replace("{nombre}", pick("nombre"));
      if (niche && Math.random()<0.8 && !out.toLowerCase().includes(niche.toLowerCase())) out = out + " — " + niche;
      if (theme && Math.random()<0.8 && !out.toLowerCase().includes(theme.toLowerCase())) out = out + " — " + theme;
      if (tone==="cash") out = out.replace("?", " !").replace("Arrête","ARRÊTE").replace("Et si","STOP");
      if (tone==="bienveillant") out = out.replace("ARRÊTE","Arrête").replace("STOP","Et si");
      if (tone==="urgent") out = out.replace("Aujourd’hui","Maintenant").replace(" ?"," ? Vite.");
      if (audience && Math.random()<0.7) out = `${audience} : ${out}`;
      return tighten(out);
    }
    function tighten(s){
      s = s.replace(/[\"“”'’]/g,"");
      const words = s.split(/\s+/);
      if (words.length > 12) s = words.slice(0,12).join(" ") + "…";
      const first = s.split(" ")[0].toUpperCase();
      if (START_VERBS.includes(first)===false && Math.random()<0.4){
        const w = s.split(" "); const n = Math.min(4, Math.max(2, Math.ceil(w.length*0.25)));
        s = w.map((x,i)=> i<n ? x.toUpperCase() : x).join(" ");
      }
      return s.replace(/\s+/g," ").trim();
    }
    function scoreHook(h, niche, theme){
      let sc = 0;
      const first = h.split(" ")[0];
      if (/^\d/.test(first)) sc += 2;
      if (START_VERBS.includes(first.toUpperCase())) sc += 2;
      if (niche && h.toLowerCase().includes(niche.toLowerCase())) sc += 2;
      if (theme && h.toLowerCase().includes(theme.toLowerCase())) sc += 2;
      const words = h.split(/\s+/).length;
      if (words<=12) sc += 2; else sc -= (words-12);
      if (/[!?:—]/.test(h)) sc += 1;
      return sc;
    }
    function offlineGenerate(){
      const niche = $('niche').value.trim();
      const theme = $('theme').value.trim();
      const tone = $('tone').value;
      const audience = $('audience').value.trim();
      const count = parseInt($('count').value,10) || 10;
      if (!niche || !theme){ toast("Niche + Thème requis"); return; }
      const pool = [];
      for(let i=0;i<count*5;i++){ pool.push(fillTemplate(niche, theme, tone, audience)); }
      const unique = uniq(pool);
      const ranked = unique.map(h => ({h, s: scoreHook(h, niche, theme)})).sort((a,b)=> b.s - a.s).slice(0, count).map(x => x.h);
      render(ranked); toast("Offline amélioré");
    }
    async function boostGenerate(){
      const niche = $('niche').value.trim();
      const theme = $('theme').value.trim();
      const tone = $('tone').value;
      const audience = $('audience').value.trim();
      const count = parseInt($('count').value,10) || 10;
      if (!niche || !theme){ toast("Niche + Thème requis"); return; }
      try{
        const res = await fetch("/api/generate-hooks", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ niche, theme, audience, tone, count })
        });
        if(!res.ok) throw new Error(await res.text());
        const { hooks=[] } = await res.json();
        if(!hooks.length) throw new Error("Pas de hooks reçus");
        render(hooks); toast("Boost AI");
      }catch(e){
        console.error(e); toast("Erreur Boost. Offline en secours."); offlineGenerate();
      }
    }
    function render(arr){
      const box = $('list'); box.innerHTML = '';
      if(!arr.length){ box.innerHTML = '<div class="sub">Rien à afficher.</div>'; return; }
      arr.forEach(h => {
        const row = document.createElement('div'); row.className='hook';
        const span = document.createElement('span'); span.textContent = h;
        const btn = document.createElement('button'); btn.className='btn secondary copy'; btn.textContent='Copier';
        btn.onclick = async ()=>{ try{ await navigator.clipboard.writeText(h); btn.textContent='Copié'; setTimeout(()=>btn.textContent='Copier',1000);}catch{} };
        row.appendChild(span); row.appendChild(btn); box.appendChild(row);
      });
    }
    $('boost').onclick = boostGenerate;
    $('offline').onclick = offlineGenerate;
    $('copyAll').onclick = async ()=>{
      const items = [...document.querySelectorAll('.hook span')].map(n=>n.textContent).join('\n');
      try{ await navigator.clipboard.writeText(items); }catch{}
    };
  </script>
</body>
</html>
